---
eleventyComputed:
  title: "{{ page.date | dateWithTime }}"
---

I had a customer raise an issue about Cloudflare One today, CF's official zero-touch client for Android, not receiving managed configurations through MDM.

While debbugging it I noted their declared managed configuration comes in to AMAPI as:

```json
"managedProperties": [
    {
      "key": "app_config_bundle_list",
      "type": "BUNDLE_ARRAY",
      "title": "App config list",
      "nestedProperties": [
        {
          "key": "app_config_bundle",
          "type": "BUNDLE",
          "title": "App config",
          "nestedProperties": [
            {
              "key": "organization",
              "type": "STRING",
              "title": "Organization",
              "description": "The user will be asked to sign into this organization. The name of the organization is case-insensitive."
            },
            {
              "key": "gateway_unique_id",
              "type": "STRING",
              "title": "Gateway Unique ID",
              "description": "Cloudflare Gateway DoH Subdomain. This option is not compatible with Cloudflare One for Families."
            },
            {
              "key": "service_mode",
              "type": "STRING",
              "title": "Service mode",
              "description": "Choose the mode in which the tunnel should run."
            },
            {
              "key": "onboarding",
              "type": "BOOL",
              "title": "Show onboarding",
              "description": "Show onboarding",
              "defaultValue": true
            },
            { so on, so forth.. }
          ]
        }
      ]
    }
  ],
```

Notably, they've built the configuration in their application as a bundle array, which is not something I see as the one and only root configuration object really.. it also doesn't align with their documentation: [https://developers.cloudflare.com/cloudflare-one/team-and-resources/devices/warp/deployment/mdm-deployment/#android--chromeos](https://developers.cloudflare.com/cloudflare-one/team-and-resources/devices/warp/deployment/mdm-deployment/#android--chromeos)

This shows the app expects: 

```json
{
  "organization": "your-team-name",
  "gateway_unique_id": "your_gateway_doh_subdomain",
  "onboarding": true,
  "switch_locked": true,
  "auto_connect": 0,
  "service_mode": "warp",
  "support_url": "https://support.example.com"
}
```

With how they've defined their application restrictions XML, an MDM won't send out a flat configuration like this without manual modification, so when sending the config from MDM, the device is receiving (via [Package Search](/projects/package-search)'s managed config tool):

```
app_config_bundle_list:
    app_config_bundle_list[0]:
        support_url: domain.com
        onboarding: true
        organization: Wrong config
        switch_locked: false
```

With a JSON of: 

```json
{
  "app_config_bundle_list": [
    {
      "onboarding": true,
      "organization": "Wrong config",
      "switch_locked": false,
      "support_url": "domain.com"
    }
  ]
}
```

Instead of the flat structure, which when manually modified in the AMAPI policy sends:

```
support_url: domain.com
onboarding: false
organization: Correct config
switch_locked: true
```

Via JSON:

```json
{
  "onboarding": false,
  "support_url": "domain.com",
  "organization": "Correct config",
  "switch_locked": true
}
```

This seems like something CloudFlare need to fix in an updated version. I should imagine MDMs like Intune can get around this by allowing direct modification of the JSON being sent out, but for those platforms that simply consume the managed properties and turn them into a form.. that's troublesome.